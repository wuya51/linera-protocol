<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A custom binary-encoded section of wasmtime compilation artifacts which encodes the ability to map an offset in the text section to the trap code that it corresponds to."><title>ELF_WASMTIME_TRAPS in wasmtime_environ - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="wasmtime_environ" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.0 (051478957 2024-07-21)" data-channel="1.80.0" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc constant"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../wasmtime_environ/index.html">wasmtime_environ</a><span class="version">1.0.2</span></h2></div><div class="sidebar-elems"></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Constant <a href="index.html">wasmtime_environ</a>::<wbr><a class="constant" href="#">ELF_WASMTIME_TRAPS</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/wasmtime_environ/trap_encoding.rs.html#44">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub const ELF_WASMTIME_TRAPS: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a> = &quot;.wasmtime.traps&quot;;</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A custom binary-encoded section of wasmtime compilation artifacts which
encodes the ability to map an offset in the text section to the trap code
that it corresponds to.</p>
<p>This section is used at runtime to determine what flavor fo trap happened to
ensure that embedders and debuggers know the reason for the wasm trap. The
encoding of this section is custom to Wasmtime and managed with helpers in
the <code>object</code> crate:</p>
<ul>
<li>First the section has a 32-bit little endian integer indicating how many
trap entries are in the section.</li>
<li>Next is an array, of the same length as read before, of 32-bit
little-endian integers. These integers are offsets into the text section
of the compilation image.</li>
<li>Finally is the same count number of bytes. Each of these bytes corresponds
to a trap code.</li>
</ul>
<p>This section is decoded by <code>lookup_trap_code</code> below which will read the
section count, slice some bytes to get the various arrays, and then perform
a binary search on the offsets array to find the an index corresponding to
the pc being looked up. If found the same index in the trap array (the array
of bytes) is the trap code for that offset.</p>
<p>Note that at this time this section has an alignment of 1. Additionally due
to the 32-bit encodings for offsets this doesn’t support images &gt;=4gb.</p>
</div></details></section></div></main></body></html>